var ext=function(){var a;return{init:function(){var a=document.URL.split("/"),b=a[0]+"//"+a[1]+a[2]+"/";ext.createCanvas(),ext.checkTop(),ext.msgHandler(b)},createCanvas:function(){var b=document.getElementsByTagName("body")[0],c=document.createElement("canvas"),d=new Date;a=Math.floor(d.getTime()*Math.PI),c.setAttribute("id",a),b.appendChild(c),document.getElementById(a).style.display="none"},checkTop:function(){var a,b,c;window.self!==window.top&&(c=document.querySelector("video"),a=document.querySelector("video").querySelector("source").src,b=a.match(/[^/]+$/),c.pause(),c.addEventListener("canplay",function(){ext.createImage(b,a)},!1))},msgHandler:function(a){var b,c;chrome.extension.onMessage.addListener(function(d){b=document.querySelector('video>source[src*="'+d.src+'"]').parentNode,c=b.currentTime,console.log(c),"create_image"==d.action&&null!=d.src&&(d.base!==a?document.getElementById("iframe-videoCapture-Frame")?document.getElementById("iframe-videoCapture-Frame").src=d.full:ext.createIframe(d.src,d.full+"#t="+c):ext.createImage(d.src,d.full))})},videoTime:function(){},createImage:function(b){var c=document.querySelector('video>source[src*="'+b+'"]').parentNode,d=document.getElementById(a),e=d.getContext("2d");console.log(c),d.width=c.offsetWidth,d.height=c.offsetHeight,e.drawImage(c,0,0,c.offsetWidth,c.offsetHeight),chrome.extension.sendRequest({image_link:d.toDataURL("img/png")},function(){})},createIframe:function(a,b){{var c,d=document.createElement("iframe"),e=new Date;e.getTime()}d.width=600,d.height=500,d.src=b,d.id="iframe-videoCapture-Frame",c=document.getElementsByTagName("body")[0].appendChild(d),document.getElementById("iframe-videoCapture-Frame").style.dispaly="none"}}}();ext.init();